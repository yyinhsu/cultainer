# Lefthook configuration for Cultainer
# https://github.com/evilmartians/lefthook

pre-commit:
  parallel: true
  commands:
    format-check:
      glob: "*.dart"
      run: dart format --set-exit-if-changed {staged_files}
      
    analyze:
      glob: "*.dart"
      run: flutter analyze --no-fatal-infos
      
    test:
      run: flutter test --no-pub

commit-msg:
  commands:
    conventional-commit:
      run: |
        commit_msg=$(cat {1})
        # Conventional Commits pattern
        pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,}"
        if ! echo "$commit_msg" | grep -qE "$pattern"; then
          echo "‚ùå Commit message does not follow Conventional Commits format."
          echo ""
          echo "Format: type(scope): description"
          echo ""
          echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
          echo ""
          echo "Examples:"
          echo "  feat(entry): add OCR text extraction"
          echo "  fix(calendar): correct date picker timezone"
          echo "  docs(readme): update installation guide"
          exit 1
        fi

pre-push:
  commands:
    test-all:
      run: flutter test
